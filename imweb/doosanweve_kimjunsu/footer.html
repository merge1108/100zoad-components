<!--
  ================================================
  100zoad 푸터 컴포넌트 - Cloudflare Pages 버전
  ================================================

  배포: https://100zoad-components.pages.dev
  고객사: 두산위브더제니스 센트럴천안 (김준수)
  버전: 2.1.0 (로딩 순서 제어 추가)

  포함 컴포넌트:
  - ✅ 푸터 (회사 정보, 법적 정보)

  사용법:
  1. 아임웹 페이지 최하단에 HTML 위젯 추가
  2. 이 파일 전체를 복사하여 붙여넣기
  3. 저장

  주의: main.html이 먼저 로드되어야 합니다!

  ================================================
-->

<!-- Pretendard 폰트 (이미 main.html에서 로드됨, 중복 방지용) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">

<!-- 푸터 섹션 (컨테이너) -->
<div id="footer-section">
  <!-- 컴포넌트가 동적으로 생성됨 -->
</div>

<!-- CONFIG 설정 및 컴포넌트 생성 -->
<script>
(function() {
  // CONFIG 병합 함수
  function mergeFooterConfig() {
    // ZOAD_CONFIG가 없으면 초기화
    if (!window.ZOAD_CONFIG) {
      window.ZOAD_CONFIG = {
        meta: {
          siteName: '두산위브더제니스 센트럴천안'
        }
      };
    }

    // 푸터 설정 추가/병합
    window.ZOAD_CONFIG.footer = {
      enabled: true,
      line1: {
        siteName: '두산위브더제니스 센트럴천안',
        phone: '1666-3170'
      },
      line2: {
        company: '럿셀',
        ceo: '최우석',
        phone: '010-4997-7087',
        businessNumber: '466-23-01872'
      },
      legal: {
        termsUrl: '',    // 이용약관 URL (선택)
        privacyUrl: '', // 개인정보처리방침 URL (선택)
        openIn: 'newTab'  // 'newTab' 또는 'popup'
      },
      styles: {
        bgColor: '#f8f9fa',
        textColor: '#666666',
        linkColor: '#003DA5'
      }
    };

    console.log('✅ [footer.html] CONFIG 설정 완료');
  }

  // 컴포넌트 생성 함수
  function createFooterComponent() {
    const container = document.getElementById('footer-section');
    if (!container) {
      console.error('❌ [footer.html] footer-section 컨테이너를 찾을 수 없습니다');
      return;
    }

    // 이미 생성된 경우 스킵
    if (container.querySelector('zoad-footer')) {
      console.log('⏭️ [footer.html] zoad-footer가 이미 존재합니다');
      return;
    }

    // 컴포넌트 생성
    const footerElement = document.createElement('zoad-footer');
    container.appendChild(footerElement);
    console.log('✅ [footer.html] zoad-footer 컴포넌트 생성');

    // 렌더링 확인
    setTimeout(function() {
      if (footerElement.shadowRoot) {
        console.log('✅ [footer.html] 푸터 렌더링 완료');
      } else {
        console.warn('⚠️ [footer.html] 푸터 렌더링 실패 - shadowRoot 없음');
      }
    }, 500);
  }

  // main.html의 ZOAD가 준비될 때까지 대기
  function waitForZoadReady(callback) {
    // 이미 준비된 경우
    if (window.__ZOAD_READY__) {
      console.log('✅ [footer.html] ZOAD 이미 준비됨');
      callback();
      return;
    }

    // zoad-footer가 등록될 때까지 대기
    if (customElements.get('zoad-footer')) {
      console.log('✅ [footer.html] zoad-footer 이미 등록됨');
      callback();
      return;
    }

    console.log('⏳ [footer.html] ZOAD 준비 대기 중...');

    // 이벤트 리스너로 대기
    window.addEventListener('zoad-ready', function() {
      console.log('✅ [footer.html] zoad-ready 이벤트 수신');
      callback();
    }, { once: true });

    // 폴링으로도 대기 (이벤트가 이미 발생한 경우 대비)
    let attempts = 0;
    const maxAttempts = 100; // 10초

    const checkInterval = setInterval(function() {
      attempts++;

      if (window.__ZOAD_READY__ || customElements.get('zoad-footer')) {
        clearInterval(checkInterval);
        callback();
      } else if (attempts >= maxAttempts) {
        clearInterval(checkInterval);
        console.error('❌ [footer.html] ZOAD 준비 타임아웃');
        // 그래도 시도해봄
        callback();
      }
    }, 100);
  }

  // 실행
  mergeFooterConfig();

  waitForZoadReady(function() {
    // zoad-footer가 정의될 때까지 추가 대기
    customElements.whenDefined('zoad-footer').then(function() {
      console.log('✅ [footer.html] zoad-footer 정의 완료');
      createFooterComponent();
    }).catch(function(err) {
      console.error('❌ [footer.html] zoad-footer 정의 실패:', err);
    });
  });
})();
</script>
