<!--
  ================================================
  100zoad ì…ë ¥í¼ ì»´í¬ë„ŒíŠ¸ - Cloudflare Pages ë²„ì „
  ================================================

  ë°°í¬: https://100zoad-components.pages.dev
  ê³ ê°ì‚¬: ë‘ì‚°ìœ„ë¸Œë”ì œë‹ˆìŠ¤ ì„¼íŠ¸ëŸ´ì²œì•ˆ (ê¹€ì¤€ìˆ˜)
  ë²„ì „: 2.2.0 (ë‹¤ì¤‘ ì¸ìŠ¤í„´ìŠ¤ ì§€ì›)

  í¬í•¨ ì»´í¬ë„ŒíŠ¸:
  - âœ… ì…ë ¥í¼ (ê´€ì‹¬ê³ ê° ë“±ë¡)

  ì‚¬ìš©ë²•:
  1. ì•„ì„ì›¹ í˜ì´ì§€ ì›í•˜ëŠ” ìœ„ì¹˜ì— HTML ìœ„ì ¯ ì¶”ê°€
  2. ì´ íŒŒì¼ ì „ì²´ë¥¼ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ê¸°
  3. ì €ì¥
  4. ì—¬ëŸ¬ ìœ„ì¹˜ì— í¼ì„ ë„£ê³  ì‹¶ìœ¼ë©´ ì´ íŒŒì¼ì„ ë³µì‚¬í•´ì„œ ì—¬ëŸ¬ ë²ˆ ì‚¬ìš© ê°€ëŠ¥

  ì£¼ì˜: main.htmlì´ ë¨¼ì € ë¡œë“œë˜ì–´ì•¼ í•©ë‹ˆë‹¤!

  ================================================
-->

<!-- Pretendard í°íŠ¸ (ì´ë¯¸ main.htmlì—ì„œ ë¡œë“œë¨, ì¤‘ë³µ ë°©ì§€ìš©) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">

<!-- ì…ë ¥í¼ ì„¹ì…˜ (ì»¨í…Œì´ë„ˆ) - ê³ ìœ  ID ìë™ ìƒì„± -->
<div class="zoad-form-section" id="zoad-form-container-__UNIQUE_ID__">
  <!-- ì»´í¬ë„ŒíŠ¸ê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
</div>

<!-- CONFIG ì„¤ì • ë° ì»´í¬ë„ŒíŠ¸ ìƒì„± -->
<script>
(function() {
  // ê³ ìœ  ID ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ + ëœë¤)
  const uniqueId = 'form_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

  // í˜„ì¬ ìŠ¤í¬ë¦½íŠ¸ ë°”ë¡œ ìœ„ì˜ div ì°¾ê¸°
  const scripts = document.getElementsByTagName('script');
  const currentScript = scripts[scripts.length - 1];
  let container = currentScript.previousElementSibling;

  // ì»¨í…Œì´ë„ˆê°€ zoad-form-section í´ë˜ìŠ¤ê°€ ì•„ë‹ˆë©´ ë‹¤ì‹œ ì°¾ê¸°
  while (container && !container.classList.contains('zoad-form-section')) {
    container = container.previousElementSibling;
  }

  // ì»¨í…Œì´ë„ˆì— ê³ ìœ  ID ë¶€ì—¬ (ì•„ì§ ì—†ìœ¼ë©´)
  if (container && container.id.includes('__UNIQUE_ID__')) {
    container.id = 'zoad-form-container-' + uniqueId;
  }

  const containerId = container ? container.id : null;
  console.log('ğŸ“‹ [form.html] ì»¨í…Œì´ë„ˆ ID:', containerId);

  // CONFIG ë³‘í•© í•¨ìˆ˜
  function mergeFormConfig() {
    // ZOAD_CONFIGê°€ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
    if (!window.ZOAD_CONFIG) {
      window.ZOAD_CONFIG = {
        meta: {
          siteName: 'ë‘ì‚°ìœ„ë¸Œë”ì œë‹ˆìŠ¤ ì„¼íŠ¸ëŸ´ì²œì•ˆ'
        }
      };
    }

    // ì…ë ¥í¼ ì„¤ì • ì¶”ê°€/ë³‘í•© (ì´ë¯¸ ìˆìœ¼ë©´ ê±´ë„ˆëœ€)
    if (!window.ZOAD_CONFIG.form) {
      window.ZOAD_CONFIG.form = {
        enabled: true,
        title: 'ê´€ì‹¬ê³ ê° ë“±ë¡',
        description: 'ê°„ë‹¨í•œ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì‹œë©´ ìƒë‹´ ì „í™”ë¥¼ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.',
        displayMode: 'both', // 'popup', 'section', 'both' - íŒì—…ë„ ì§€ì›í•˜ë„ë¡ ë³€ê²½
        fields: {
          name: {
            label: 'ì´ë¦„',
            placeholder: 'í™ê¸¸ë™',
            required: true
          },
          phone: {
            label: 'ì „í™”ë²ˆí˜¸',
            placeholder: '010-1234-5678',
            required: true
          }
        },
        airtable: {
          workerUrl: 'https://100zoad-airtable-proxy.choiwseok.workers.dev/submit'
        },
        legal: {
          termsText: 'ë³¸ ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤.',
          privacyText: 'ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤. ìˆ˜ì§‘í•­ëª©: ì´ë¦„, ì—°ë½ì²˜ / ìˆ˜ì§‘ëª©ì : ìƒë‹´ ë° ë¶„ì–‘ ì•ˆë‚´ / ë³´ìœ ê¸°ê°„: ë¶„ì–‘ ì™„ë£Œ í›„ 1ë…„'
        },
        messages: {
          success: 'âœ“ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!',
          error: 'ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
        },
        styles: {
          primaryColor: '#003DA5',
          bgColor: '#ffffff',
          textColor: '#333333'
        }
      };
      console.log('âœ… [form.html] CONFIG ì„¤ì • ì™„ë£Œ');
    } else {
      console.log('â­ï¸ [form.html] CONFIG ì´ë¯¸ ì¡´ì¬ (ë³‘í•© ìŠ¤í‚µ)');
    }
  }

  // ì»´í¬ë„ŒíŠ¸ ìƒì„± í•¨ìˆ˜
  function createFormComponent() {
    // IDë¡œ ì»¨í…Œì´ë„ˆ ì°¾ê¸°
    const targetContainer = containerId ? document.getElementById(containerId) : null;

    if (!targetContainer) {
      console.error('âŒ [form.html] ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', containerId);
      return;
    }

    // ì´ë¯¸ ì´ ì»¨í…Œì´ë„ˆì— ìƒì„±ëœ ê²½ìš° ìŠ¤í‚µ
    if (targetContainer.querySelector('zoad-form')) {
      console.log('â­ï¸ [form.html] zoad-formì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤ (ì»¨í…Œì´ë„ˆ:', containerId, ')');
      return;
    }

    // ì»´í¬ë„ŒíŠ¸ ìƒì„±
    const formElement = document.createElement('zoad-form');
    targetContainer.appendChild(formElement);
    console.log('âœ… [form.html] zoad-form ì»´í¬ë„ŒíŠ¸ ìƒì„± (ì»¨í…Œì´ë„ˆ:', containerId, ')');

    // ë Œë”ë§ í™•ì¸
    setTimeout(function() {
      if (formElement.shadowRoot) {
        console.log('âœ… [form.html] ì…ë ¥í¼ ë Œë”ë§ ì™„ë£Œ (ì»¨í…Œì´ë„ˆ:', containerId, ')');
      } else {
        console.warn('âš ï¸ [form.html] ì…ë ¥í¼ ë Œë”ë§ ì‹¤íŒ¨ - shadowRoot ì—†ìŒ');
      }
    }, 500);
  }

  // main.htmlì˜ ZOADê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°
  function waitForZoadReady(callback) {
    // ì´ë¯¸ ì¤€ë¹„ëœ ê²½ìš°
    if (window.__ZOAD_READY__) {
      console.log('âœ… [form.html] ZOAD ì´ë¯¸ ì¤€ë¹„ë¨');
      callback();
      return;
    }

    // zoad-formì´ ë“±ë¡ë  ë•Œê¹Œì§€ ëŒ€ê¸°
    if (customElements.get('zoad-form')) {
      console.log('âœ… [form.html] zoad-form ì´ë¯¸ ë“±ë¡ë¨');
      callback();
      return;
    }

    console.log('â³ [form.html] ZOAD ì¤€ë¹„ ëŒ€ê¸° ì¤‘...');

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¡œ ëŒ€ê¸°
    window.addEventListener('zoad-ready', function() {
      console.log('âœ… [form.html] zoad-ready ì´ë²¤íŠ¸ ìˆ˜ì‹ ');
      callback();
    }, { once: true });

    // í´ë§ìœ¼ë¡œë„ ëŒ€ê¸° (ì´ë²¤íŠ¸ê°€ ì´ë¯¸ ë°œìƒí•œ ê²½ìš° ëŒ€ë¹„)
    let attempts = 0;
    const maxAttempts = 100; // 10ì´ˆ

    const checkInterval = setInterval(function() {
      attempts++;

      if (window.__ZOAD_READY__ || customElements.get('zoad-form')) {
        clearInterval(checkInterval);
        callback();
      } else if (attempts >= maxAttempts) {
        clearInterval(checkInterval);
        console.error('âŒ [form.html] ZOAD ì¤€ë¹„ íƒ€ì„ì•„ì›ƒ');
        // ê·¸ë˜ë„ ì‹œë„í•´ë´„
        callback();
      }
    }, 100);
  }

  // ì‹¤í–‰
  mergeFormConfig();

  waitForZoadReady(function() {
    // zoad-formì´ ì •ì˜ë  ë•Œê¹Œì§€ ì¶”ê°€ ëŒ€ê¸°
    customElements.whenDefined('zoad-form').then(function() {
      console.log('âœ… [form.html] zoad-form ì •ì˜ ì™„ë£Œ');
      createFormComponent();
    }).catch(function(err) {
      console.error('âŒ [form.html] zoad-form ì •ì˜ ì‹¤íŒ¨:', err);
    });
  });
})();
</script>

<!--
  ================================================
  ğŸ“ ì¶”ê°€ í•„ë“œ ì„¤ì • ì˜ˆì‹œ
  ================================================

  ì•„ë˜ ì£¼ì„ì„ í•´ì œí•˜ì—¬ ì¶”ê°€ í•„ë“œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

  <script>
  // ì´ë©”ì¼ í•„ë“œ ì¶”ê°€
  window.ZOAD_CONFIG.form.fields.email = {
    type: 'text',
    label: 'ì´ë©”ì¼',
    placeholder: 'example@email.com',
    required: false
  };

  // ê´€ì‹¬í‰í˜• ì„ íƒ ì¶”ê°€
  window.ZOAD_CONFIG.form.fields.interest = {
    type: 'select',
    label: 'ê´€ì‹¬í‰í˜•',
    options: ['84ã¡', '99ã¡', '110ã¡', 'ê¸°íƒ€'],
    required: false
  };

  // ë¬¸ì˜ì‚¬í•­ ì¶”ê°€
  window.ZOAD_CONFIG.form.fields.message = {
    type: 'textarea',
    label: 'ë¬¸ì˜ì‚¬í•­',
    placeholder: 'ê¶ê¸ˆí•œ ì ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”',
    required: false
  };
  </script>

  ================================================
-->
